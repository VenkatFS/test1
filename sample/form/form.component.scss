private removeDuplicateMessages(messages: any[]): any[] {
  if (!Array.isArray(messages)) return [];

  // Sort messages by createdAt (descending: newest first)
  const sorted = [...messages].sort((a, b) => {
    const aTime = new Date(a?.createdAt || 0).getTime();
    const bTime = new Date(b?.createdAt || 0).getTime();
    return bTime - aTime;
  });

  // Deduplicate by message_id, keeping the *latest* message
  const uniqueMap = new Map<string, any>();
  for (const msg of sorted) {
    if (!msg?.message_id) continue;
    if (!uniqueMap.has(msg.message_id)) {
      uniqueMap.set(msg.message_id, msg);
    }
  }

  // Return the deduped, sorted list
  return Array.from(uniqueMap.values());
}
